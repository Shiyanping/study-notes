<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端学习笔记及思维导图 | virtual dom(虚拟 DOM)</title>
    <meta name="description" content="总结前端学习过程中的笔记，根据自己的思维结构画出脑海中的思维导图，有助于学习前端知识。">
    <link rel="icon" href="/study-notes/logo.jpg">
    
    <link rel="preload" href="/study-notes/assets/css/40.styles.674d4f45.css" as="style"><link rel="preload" href="/study-notes/assets/js/app.403b6997.js" as="script"><link rel="preload" href="/study-notes/assets/js/2.67160c25.js" as="script"><link rel="prefetch" href="/study-notes/assets/js/19.122c00dd.js"><link rel="prefetch" href="/study-notes/assets/js/0.a48ab10b.js"><link rel="prefetch" href="/study-notes/assets/js/1.728eb2ad.js"><link rel="prefetch" href="/study-notes/assets/js/3.d8d9a108.js"><link rel="prefetch" href="/study-notes/assets/js/4.e8551997.js"><link rel="prefetch" href="/study-notes/assets/js/5.a02d4e5d.js"><link rel="prefetch" href="/study-notes/assets/js/6.d95f122c.js"><link rel="prefetch" href="/study-notes/assets/js/7.1a0fe8cc.js"><link rel="prefetch" href="/study-notes/assets/js/8.e661f840.js"><link rel="prefetch" href="/study-notes/assets/js/9.9c0ba153.js"><link rel="prefetch" href="/study-notes/assets/js/10.890e7606.js"><link rel="prefetch" href="/study-notes/assets/js/11.cc0a35b6.js"><link rel="prefetch" href="/study-notes/assets/js/12.f833d50f.js"><link rel="prefetch" href="/study-notes/assets/js/13.e3c335c5.js"><link rel="prefetch" href="/study-notes/assets/js/14.cb2749b8.js"><link rel="prefetch" href="/study-notes/assets/js/15.ded5c853.js"><link rel="prefetch" href="/study-notes/assets/js/16.e6368c73.js"><link rel="prefetch" href="/study-notes/assets/js/17.cbce4206.js"><link rel="prefetch" href="/study-notes/assets/js/18.7f1c5db3.js"><link rel="prefetch" href="/study-notes/assets/js/20.4ca54c11.js"><link rel="prefetch" href="/study-notes/assets/js/21.a0dc2a02.js"><link rel="prefetch" href="/study-notes/assets/js/22.ef8b4e2f.js"><link rel="prefetch" href="/study-notes/assets/js/23.4eed920c.js"><link rel="prefetch" href="/study-notes/assets/js/24.b5cc3303.js"><link rel="prefetch" href="/study-notes/assets/js/25.c4fe71d5.js"><link rel="prefetch" href="/study-notes/assets/js/26.108f8891.js"><link rel="prefetch" href="/study-notes/assets/js/27.3a82b22e.js"><link rel="prefetch" href="/study-notes/assets/js/28.9037a9da.js"><link rel="prefetch" href="/study-notes/assets/js/29.173185b0.js"><link rel="prefetch" href="/study-notes/assets/js/30.853bb732.js"><link rel="prefetch" href="/study-notes/assets/js/31.0511c245.js"><link rel="prefetch" href="/study-notes/assets/js/32.33565ee9.js"><link rel="prefetch" href="/study-notes/assets/js/33.79db5533.js"><link rel="prefetch" href="/study-notes/assets/js/34.baf0685a.js"><link rel="prefetch" href="/study-notes/assets/js/35.2f3d2102.js"><link rel="prefetch" href="/study-notes/assets/js/36.f97a3af3.js"><link rel="prefetch" href="/study-notes/assets/js/37.82254956.js"><link rel="prefetch" href="/study-notes/assets/js/38.6eee7d87.js"><link rel="prefetch" href="/study-notes/assets/js/39.bd696d87.js">
    <link rel="stylesheet" href="/study-notes/assets/css/40.styles.674d4f45.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/study-notes/" class="home-link router-link-active"><!----><span class="site-name">
      前端学习笔记及思维导图
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.shiyanping.top/" target="_blank" rel="noopener noreferrer" class="nav-link">博客</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的相关</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="http://www.shiyanping.top//resume/" target="_blank" rel="noopener noreferrer" class="nav-link">简历</a></li><li class="dropdown-item"><!----><a href="http://www.shiyanping.top/fe-tool" target="_blank" rel="noopener noreferrer" class="nav-link">前端工具集</a></li></ul></div></div><a href="https://github.com/Shiyanping/study-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.shiyanping.top/" target="_blank" rel="noopener noreferrer" class="nav-link">博客</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的相关</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="http://www.shiyanping.top//resume/" target="_blank" rel="noopener noreferrer" class="nav-link">简历</a></li><li class="dropdown-item"><!----><a href="http://www.shiyanping.top/fe-tool" target="_blank" rel="noopener noreferrer" class="nav-link">前端工具集</a></li></ul></div></div><a href="https://github.com/Shiyanping/study-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>你不知道的 JavaScript</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS 的世界</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTML</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Vue</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/study-notes/vue/mvvm.html" class="sidebar-link">MVVM</a></li><li><a href="/study-notes/vue/virtual-dom.html" class="active sidebar-link">virtual dom(虚拟 DOM)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-notes/vue/virtual-dom.html#什么是-vdom" class="sidebar-link">什么是 vdom</a></li><li class="sidebar-sub-header"><a href="/study-notes/vue/virtual-dom.html#为什么使用-vdom" class="sidebar-link">为什么使用 vdom</a></li><li class="sidebar-sub-header"><a href="/study-notes/vue/virtual-dom.html#vdom-如何应用" class="sidebar-link">vdom 如何应用</a></li><li class="sidebar-sub-header"><a href="/study-notes/vue/virtual-dom.html#diff-算法" class="sidebar-link">diff 算法</a></li></ul></li><li><a href="/study-notes/vue/vue-basic.html" class="sidebar-link">vue 基础</a></li><li><a href="/study-notes/vue/vue-animation.html" class="sidebar-link">vue 中的动画</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>服务器端常识</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Node 半知半解</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>世界上最好的语言 PHP</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>网络协议</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>浏览器知识</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>自动化测试</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>性能优化</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>工程化</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>软件工程学</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="virtual-dom-虚拟-dom"><a href="#virtual-dom-虚拟-dom" aria-hidden="true" class="header-anchor">#</a> virtual dom(虚拟 DOM)</h1><h2 id="什么是-vdom"><a href="#什么是-vdom" aria-hidden="true" class="header-anchor">#</a> 什么是 vdom</h2><ul><li>统称为虚拟 DOM，不是真正的 DOM</li><li>使用 JS 模拟 DOM 结构</li><li>DOM 变化的对比，放在 JS 层来做（图灵完备语言）</li><li>使用 vdom 提高重绘性能</li></ul><blockquote><p>图灵完备的语言：处理逻辑，实现算法，能够使用判断，使用递归等处理算法的语言</p></blockquote><h2 id="为什么使用-vdom"><a href="#为什么使用-vdom" aria-hidden="true" class="header-anchor">#</a> 为什么使用 vdom</h2><ul><li>DOM 操作比较昂贵，会影响页面性能</li></ul><p>例： jquery 渲染一个表格，然后修改表格里面的内容</p><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>jquery 模拟虚拟 dom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>change-btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>change<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
      <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
          age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          address<span class="token punctuation">:</span> <span class="token string">'北京'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'李四'</span><span class="token punctuation">,</span>
          age<span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
          address<span class="token punctuation">:</span> <span class="token string">'上海'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'王麻子'</span><span class="token punctuation">,</span>
          age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
          address<span class="token punctuation">:</span> <span class="token string">'南京'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">// 渲染函数</span>
      <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> $container <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 清空容器</span>
        $container<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 拼接table</span>
        <span class="token keyword">var</span> $table <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;table&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        $table<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;tr&gt;&lt;td&gt;name&lt;/td&gt;&lt;td&gt;age&lt;/td&gt;&lt;td&gt;address&lt;/td&gt;&lt;/tr&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>value <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          $table<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;tr&gt;&lt;td&gt;'</span> <span class="token operator">+</span> value<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;&lt;td&gt;'</span> <span class="token operator">+</span> value<span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;&lt;td&gt;'</span> <span class="token operator">+</span> value<span class="token punctuation">.</span>address <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;&lt;/tr&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 渲染到页面,当元素添加完成之后再将元素渲染到页面中，有助于提供性能</span>
        $container<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>$table<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#change-btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token string">'深圳'</span><span class="token punctuation">;</span>
        <span class="token comment">// 再次渲染</span>
        <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 初次渲染，页面加载完之后立刻执行</span>
      <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>在根据数据生成表格时或者修改了表格内容时，会将承载表格的容器彻底清空，然后重新将生成好的表格 append 其中，这样操作对于页面性能上损耗很大，在做大项目时，频繁的 dom 操作会使项目运行时越来越卡，所以衍生出了 vdom</p><h2 id="vdom-如何应用"><a href="#vdom-如何应用" aria-hidden="true" class="header-anchor">#</a> vdom 如何应用</h2><h3 id="snabbdom-介绍"><a href="#snabbdom-介绍" aria-hidden="true" class="header-anchor">#</a> snabbdom 介绍</h3><p>vue2.0 以上中 vdom 就是借鉴 snabbdom 实现的</p><h3 id="snabbdom-核心-api"><a href="#snabbdom-核心-api" aria-hidden="true" class="header-anchor">#</a> snabbdom 核心 API</h3><ul><li><p>h 函数，模拟 vnode，传三个参数</p><ol><li>第一个参数 dom 的类型及名称</li><li>第二个参数 dom 需要添加的内敛样式、绑定的事件、内置属性</li><li>第三个参数 dom 的内容</li></ol></li><li><p>patch 函数，两个参数，两种使用方式</p><ol><li>第一种使用方式是给空白的 dom 添加元素
<ol><li>第一个参数是空白的节点</li><li>第二个参数是 h 函数生成需要添加的元素</li></ol></li><li>第二种使用方式是给原有的 dom 更新内容
<ol><li>第一个参数是 h 函数生成旧的节点</li><li>第二个参数是 h 函数新生成的节点，用于更新老的节点</li></ol></li></ol></li></ul><h3 id="snabbdom-案例"><a href="#snabbdom-案例" aria-hidden="true" class="header-anchor">#</a> snabbdom 案例</h3><p>例：使用 snabbdom 重写上面 jQuery 渲染 table 的例子</p><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>snabbdom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>btn-change<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>change<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/snabbdom/0.7.1/snabbdom.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/snabbdom/0.7.1/snabbdom-class.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/snabbdom/0.7.1/snabbdom-props.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/snabbdom/0.7.1/snabbdom-style.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/snabbdom/0.7.1/snabbdom-eventlisteners.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/snabbdom/0.7.1/h.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
      <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
          age<span class="token punctuation">:</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
          address<span class="token punctuation">:</span> <span class="token string">'地址'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
          age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          address<span class="token punctuation">:</span> <span class="token string">'北京'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'李四'</span><span class="token punctuation">,</span>
          age<span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
          address<span class="token punctuation">:</span> <span class="token string">'上海'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'王麻子'</span><span class="token punctuation">,</span>
          age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
          address<span class="token punctuation">:</span> <span class="token string">'南京'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> snabbdom <span class="token operator">=</span> window<span class="token punctuation">.</span>snabbdom<span class="token punctuation">;</span>

      <span class="token comment">// 定义 patch</span>
      <span class="token keyword">var</span> patch <span class="token operator">=</span> snabbdom<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span>snabbdom_class<span class="token punctuation">,</span> snabbdom_props<span class="token punctuation">,</span> snabbdom_style<span class="token punctuation">,</span> snabbdom_eventlisteners<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 定义 h</span>
      <span class="token keyword">var</span> h <span class="token operator">=</span> snabbdom<span class="token punctuation">.</span>h<span class="token punctuation">;</span>

      <span class="token keyword">var</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> changeBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn-change'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">var</span> vnode<span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> newVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span>
          <span class="token string">'table'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> tds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> i<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                tds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> tds<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/**
         * 判断是否为初次渲染 vdom
         * 如果是第一次则将 vnode 添加到空白元素
         * 如果不是第一次则将新生成的 vnode 与旧的 vnode 进行对比，修改变化的地方
         */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">patch</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">patch</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 每次渲染完之后将生成的 vnode 赋值给 oldVnode</span>
        vnode <span class="token operator">=</span> newVnode<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      changeBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token string">'深圳'</span><span class="token punctuation">;</span>
        <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 初次渲染</span>
      <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>使用 snabbdom 创建 vdom，点击修改时，通过新生成的 vdom 去对比老的 vdom，将不同的地方进行替换，并不会将整个大元素清空，然后重新渲染，只是局部修改，有效的减少了 dom 操作，提升性能</p><h2 id="diff-算法"><a href="#diff-算法" aria-hidden="true" class="header-anchor">#</a> diff 算法</h2><h3 id="diff-的用处"><a href="#diff-的用处" aria-hidden="true" class="header-anchor">#</a> diff 的用处</h3><ul><li>linux 中的 diff 命令，查看两个文本文件的不同</li><li>git diff 对比两个文件的不同</li><li>vue，react 中 diff 算法对比 vdom 中的不同</li></ul><h3 id="vdom-中为什么应用-diff-算法"><a href="#vdom-中为什么应用-diff-算法" aria-hidden="true" class="header-anchor">#</a> vdom 中为什么应用 diff 算法</h3><p>因为 DOM 操作是“昂贵”的，所以要尽量减少 DOM 操作，找出本次 DOM 必须更新的节点来更新，其他的不更新，“找出”的过程，就需要 diff 算法</p><h3 id="diff-算法在-vdom-中实现原理"><a href="#diff-算法在-vdom-中实现原理" aria-hidden="true" class="header-anchor">#</a> diff 算法在 vdom 中实现原理</h3><p><code>snabbdom.js</code> 中的 patch 函数就是执行了 diff 算法</p><ul><li><code>patch(dom, vnode)</code> 将生成的 vdom 添加到空白的 dom 元素中</li></ul><p>使用简单的代码实现<code>patch(dom, vnode)</code>，<strong>只是简单的实现思路，并不能直接运行</strong>。</p><pre class="language-javascript"><code><span class="token comment">// vnode 的数据模型</span>
<span class="token comment">// vnode = {</span>
<span class="token comment">//   &quot;tag&quot;: 'ul',</span>
<span class="token comment">//   &quot;attrs&quot;: {&quot;id&quot;: 'list'},</span>
<span class="token comment">//   &quot;children&quot;: [{</span>
<span class="token comment">//     &quot;tag&quot;: 'li',</span>
<span class="token comment">//     &quot;attrs&quot;: { &quot;className&quot;: 'item'},</span>
<span class="token comment">//     &quot;children&quot;: ['item1']</span>
<span class="token comment">//   }, {</span>
<span class="token comment">//     &quot;tag&quot;: 'li',</span>
<span class="token comment">//     &quot;attrs&quot;: { &quot;className&quot;: 'item'},</span>
<span class="token comment">//     &quot;children&quot;: ['item2']</span>
<span class="token comment">//   }]</span>
<span class="token comment">// }</span>

<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag<span class="token punctuation">;</span>
  <span class="token keyword">var</span> attrs <span class="token operator">=</span> vnode<span class="token punctuation">.</span>attrs <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 创建真实的 DOM 元素</span>
  <span class="token keyword">var</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 属性</span>
  <span class="token keyword">var</span> attrName<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>attrName <span class="token keyword">in</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>attrs<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 给 elem 添加属性</span>
      elem<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>attrName<span class="token punctuation">,</span> attrs<span class="token punctuation">[</span>attrName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 子元素</span>
  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>childVnode <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 给 elem 添加子元素</span>
    elem<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>childVnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 返回真实的 dom 元素</span>
  <span class="token keyword">return</span> elem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><ul><li><code>patch(vnode, newVnode)</code> 将新生成的 vdom 与 现有的 vdom 进行对比，只修改变化的地方</li></ul><p>使用如下代码实现简单的元素检测不同及替换的逻辑，<strong>只是简单的逻辑，想深究的可以去网上找专门的 diff 算法</strong></p><pre class="language-javascript"><code><span class="token comment">// vnode 变化的数据模型</span>
<span class="token comment">// vnode = {</span>
<span class="token comment">//   &quot;tag&quot;: 'ul',</span>
<span class="token comment">//   &quot;attrs&quot;: {&quot;id&quot;: 'list'},</span>
<span class="token comment">//   &quot;children&quot;: [{</span>
<span class="token comment">//     &quot;tag&quot;: 'li',</span>
<span class="token comment">//     &quot;attrs&quot;: { &quot;className&quot;: 'item'},</span>
<span class="token comment">//     &quot;children&quot;: ['item1']</span>
<span class="token comment">//   }, {</span>
<span class="token comment">//     &quot;tag&quot;: 'li',</span>
<span class="token comment">//     &quot;attrs&quot;: { &quot;className&quot;: 'item'},</span>
<span class="token comment">//     &quot;children&quot;: ['item2']</span>
<span class="token comment">//   }]</span>
<span class="token comment">// }</span>
<span class="token comment">// newVnode = {</span>
<span class="token comment">//   &quot;tag&quot;: 'ul',</span>
<span class="token comment">//   &quot;attrs&quot;: {&quot;id&quot;: 'list'},</span>
<span class="token comment">//   &quot;children&quot;: [{</span>
<span class="token comment">//     &quot;tag&quot;: 'li',</span>
<span class="token comment">//     &quot;attrs&quot;: { &quot;className&quot;: 'item'},</span>
<span class="token comment">//     &quot;children&quot;: ['item1']</span>
<span class="token comment">//   }, {</span>
<span class="token comment">//     &quot;tag&quot;: 'li',</span>
<span class="token comment">//     &quot;attrs&quot;: { &quot;className&quot;: 'item'},</span>
<span class="token comment">//     &quot;children&quot;: ['itemB']</span>
<span class="token comment">//   }, {</span>
<span class="token comment">//     &quot;tag&quot;: 'li',</span>
<span class="token comment">//     &quot;attrs&quot;: { &quot;className&quot;: 'item'},</span>
<span class="token comment">//     &quot;children&quot;: ['item23]</span>
<span class="token comment">//   }]</span>
<span class="token comment">// }</span>

<span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> newChildren <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>childVnode<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newChildVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>childVnode<span class="token punctuation">.</span>tag <span class="token operator">==</span> newChildVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 没变化继续对比，深层对比</span>
      <span class="token function">updateChildren</span><span class="token punctuation">(</span>childVnode<span class="token punctuation">,</span> newChildVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 改变了替换</span>
      <span class="token function">replaceNode</span><span class="token punctuation">(</span>childVnode<span class="token punctuation">,</span> newChildVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">replaceNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> elem <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elem<span class="token punctuation">;</span>
  <span class="token keyword">var</span> newElem <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 替换</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="content edit-link"><a href="https://github.com/Shiyanping/study-notes/edit/vuepress/docs/vue/virtual-dom.md" target="_blank" rel="noopener noreferrer">欢迎大家来补充</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/study-notes/vue/mvvm.html" class="prev">
          MVVM
        </a></span><span class="next"><a href="/study-notes/vue/vue-basic.html">
          vue 基础
        </a> →
      </span></p></div></div></div></div>
    <script src="/study-notes/assets/js/2.67160c25.js" defer></script><script src="/study-notes/assets/js/app.403b6997.js" defer></script>
  </body>
</html>
