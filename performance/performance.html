<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端学习笔记及思维导图 | 性能优化</title>
    <meta name="description" content="总结前端学习过程中的笔记，根据自己的思维结构画出脑海中的思维导图，有助于学习前端知识。">
    <link rel="icon" href="/study-notes/logo.jpg">
    
    <link rel="preload" href="/study-notes/assets/css/40.styles.674d4f45.css" as="style"><link rel="preload" href="/study-notes/assets/js/app.403b6997.js" as="script"><link rel="preload" href="/study-notes/assets/js/22.ef8b4e2f.js" as="script"><link rel="prefetch" href="/study-notes/assets/js/19.122c00dd.js"><link rel="prefetch" href="/study-notes/assets/js/0.a48ab10b.js"><link rel="prefetch" href="/study-notes/assets/js/1.728eb2ad.js"><link rel="prefetch" href="/study-notes/assets/js/2.67160c25.js"><link rel="prefetch" href="/study-notes/assets/js/3.d8d9a108.js"><link rel="prefetch" href="/study-notes/assets/js/4.e8551997.js"><link rel="prefetch" href="/study-notes/assets/js/5.a02d4e5d.js"><link rel="prefetch" href="/study-notes/assets/js/6.d95f122c.js"><link rel="prefetch" href="/study-notes/assets/js/7.1a0fe8cc.js"><link rel="prefetch" href="/study-notes/assets/js/8.e661f840.js"><link rel="prefetch" href="/study-notes/assets/js/9.9c0ba153.js"><link rel="prefetch" href="/study-notes/assets/js/10.890e7606.js"><link rel="prefetch" href="/study-notes/assets/js/11.cc0a35b6.js"><link rel="prefetch" href="/study-notes/assets/js/12.f833d50f.js"><link rel="prefetch" href="/study-notes/assets/js/13.e3c335c5.js"><link rel="prefetch" href="/study-notes/assets/js/14.cb2749b8.js"><link rel="prefetch" href="/study-notes/assets/js/15.ded5c853.js"><link rel="prefetch" href="/study-notes/assets/js/16.e6368c73.js"><link rel="prefetch" href="/study-notes/assets/js/17.cbce4206.js"><link rel="prefetch" href="/study-notes/assets/js/18.7f1c5db3.js"><link rel="prefetch" href="/study-notes/assets/js/20.4ca54c11.js"><link rel="prefetch" href="/study-notes/assets/js/21.a0dc2a02.js"><link rel="prefetch" href="/study-notes/assets/js/23.4eed920c.js"><link rel="prefetch" href="/study-notes/assets/js/24.b5cc3303.js"><link rel="prefetch" href="/study-notes/assets/js/25.c4fe71d5.js"><link rel="prefetch" href="/study-notes/assets/js/26.108f8891.js"><link rel="prefetch" href="/study-notes/assets/js/27.3a82b22e.js"><link rel="prefetch" href="/study-notes/assets/js/28.9037a9da.js"><link rel="prefetch" href="/study-notes/assets/js/29.173185b0.js"><link rel="prefetch" href="/study-notes/assets/js/30.853bb732.js"><link rel="prefetch" href="/study-notes/assets/js/31.0511c245.js"><link rel="prefetch" href="/study-notes/assets/js/32.33565ee9.js"><link rel="prefetch" href="/study-notes/assets/js/33.79db5533.js"><link rel="prefetch" href="/study-notes/assets/js/34.baf0685a.js"><link rel="prefetch" href="/study-notes/assets/js/35.2f3d2102.js"><link rel="prefetch" href="/study-notes/assets/js/36.f97a3af3.js"><link rel="prefetch" href="/study-notes/assets/js/37.82254956.js"><link rel="prefetch" href="/study-notes/assets/js/38.6eee7d87.js"><link rel="prefetch" href="/study-notes/assets/js/39.bd696d87.js">
    <link rel="stylesheet" href="/study-notes/assets/css/40.styles.674d4f45.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/study-notes/" class="home-link router-link-active"><!----><span class="site-name">
      前端学习笔记及思维导图
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.shiyanping.top/" target="_blank" rel="noopener noreferrer" class="nav-link">博客</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的相关</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="http://www.shiyanping.top//resume/" target="_blank" rel="noopener noreferrer" class="nav-link">简历</a></li><li class="dropdown-item"><!----><a href="http://www.shiyanping.top/fe-tool" target="_blank" rel="noopener noreferrer" class="nav-link">前端工具集</a></li></ul></div></div><a href="https://github.com/Shiyanping/study-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.shiyanping.top/" target="_blank" rel="noopener noreferrer" class="nav-link">博客</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的相关</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="http://www.shiyanping.top//resume/" target="_blank" rel="noopener noreferrer" class="nav-link">简历</a></li><li class="dropdown-item"><!----><a href="http://www.shiyanping.top/fe-tool" target="_blank" rel="noopener noreferrer" class="nav-link">前端工具集</a></li></ul></div></div><a href="https://github.com/Shiyanping/study-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>你不知道的 JavaScript</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS 的世界</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTML</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>服务器端常识</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Node 半知半解</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>世界上最好的语言 PHP</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>网络协议</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>浏览器知识</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>自动化测试</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>性能优化</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/study-notes/performance/performance.html" class="active sidebar-link">性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-notes/performance/performance.html#_1-前端性能优化" class="sidebar-link">1. 前端性能优化</a></li><li class="sidebar-sub-header"><a href="/study-notes/performance/performance.html#_2-服务器性能优化" class="sidebar-link">2. 服务器性能优化</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>工程化</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>软件工程学</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="性能优化"><a href="#性能优化" aria-hidden="true" class="header-anchor">#</a> 性能优化</h1><h2 id="_1-前端性能优化"><a href="#_1-前端性能优化" aria-hidden="true" class="header-anchor">#</a> 1. 前端性能优化</h2><h3 id="_1-1-雅虎军规"><a href="#_1-1-雅虎军规" aria-hidden="true" class="header-anchor">#</a> 1.1 雅虎军规</h3><ol><li>减少 HTTP 请求，合并 HTTP 请求</li><li>减少 DNS 查找次数，可以使用 DNS 预解析</li><li>减少不必要的跳转，减少 301，302 重定向</li><li>做缓存，ETag，expiress，cache-control</li><li>减少 DOM 元素，在用 JS 操作 dom 时，对需要重复使用 dom 进行变量缓存，防止多次获取 dom</li><li>延迟加载，图片的懒加载</li><li>预加载，在一个页面预先加载另外一个页面</li><li>尽量不要使用 iframe</li><li>静态资源一定要使用 CDN 进行内容分发</li><li>不要将所有的资源都放到一个域名下，因为浏览器在解析同一个域名下的资源时会有限制，超过一定数量之后的资源需要等前面的资源加载完毕之后再加载，比如 Google 浏览器同时可以加载一个域名下的 6 个资源</li><li>静态资源（JS，CSS，image）进行压缩合并，不要重复引用同一个资源，在下发静态资源时服务器要启用 gzip 压缩</li><li>能使用 ssr 是最好的，服务器可以先使用模板对页面骨架首屏内容进行输出，后续加载的内容交给页面中的 JS 处理</li><li>CSS 在顶部，JS 在底部，防止 CSS 在底部对页面造成重绘，防止 JS 在前面阻塞页面渲染</li><li>减少 cookie 体积</li><li>favicon.ico 在移动端可以做成不显示，PC 可以使用 base64</li></ol><h3 id="_1-2-重绘重排"><a href="#_1-2-重绘重排" aria-hidden="true" class="header-anchor">#</a> 1.2 重绘重排</h3><p>什么情况下会造成重排：</p><ol><li>添加或者删除元素的时候</li><li>元素的位置发生改变时</li><li>页面初始化</li><li>内容变化。在标准盒模型下添加 padding，border 就会造成重排，所以在书写样式的时候，很多会将盒模型设计成怪异盒模型（box-sizing: border-box）</li><li>js 读取或者修改元素的 offset，width，height，scroll 时，因为在 js 中读取，会导致代码不知所措，不知道该不该继续优化页面，所以会导致重排。使用 requestAnimationFrame 可以进行优化，在下一帧进行操作。</li></ol><p>GPU:用来加速处理计算请求，一般是涉及图形、视频的渲染。</p><p>谷歌浏览器检测重绘工具：右上角...，moretool，rendering。</p><p><strong>浏览器渲染过程</strong>：</p><p>1.解析 html,xhtml,svg，形成 dom 树。</p><p>2.解析 css，产生 css rule tree。</p><p>3.解析 js，js 会通过 api 来操作 dom tree 和 css rule tree。</p><p>4.构建 render tree(把 dom tree 和 css rule tree 合并)</p><p>5.浏览器对元素进行定位和布局(reflow、layout、回流)</p><p>6.浏览器绘制元素，即重绘或 repaint(样式，颜色，背景，大小及边框等)</p><p>7.将各层发给 GPU，GPU 将各层合成，显示在屏幕上，即 composite。</p><p>回流(布局变化引起回流)与重绘(只要元素样式变化就引起重绘)都耗费浏览器性能，尤其是回流。(回流一定引起重绘，重绘不一定回流)。</p><p>优化:浏览器为了优化，浏览器会将 reflow 和 repaint 的操作积攒一批，然后做一次 reflow。但是有些时候，你的代码会强制浏览器做多次 reflow。比如用 js 多个样式多次改变，而不是多个样式改变放在一次操作里。</p><p><strong>下面是一些针对 reflow 和 repaint 的最佳实践：</strong></p><ol><li>不要一条一条地修改 dom 的样式，尽量使用 className 一次修改。</li><li>将 dom 离线后修改</li><li>使用 documentFragment 对象在内存里操作 dom。</li><li>先把 dom 节点 display:none;（会触发一次 reflow）。然后做大量的修改后，再把它显示出来。</li><li>clone 一个 dom 节点在内存里，修改之后；与在线的节点相替换。</li><li>不要使用 table 布局，一个小改动会造成整个 table 的重新布局。</li><li>transform 和 opacity 只会引起合成，不会引起布局和重绘。</li></ol><p><strong>composite-合成的工作方式:</strong></p><p>每一次重绘后，浏览器都把重绘后的图像发给 GPU 去合成并显示。</p><p>在动画中，浏览器每一帧都发给 GPU 去合成，因为回流和重绘发生在动画的每一帧。</p><ol><li>js 写的动画，过程:js 计算-(回流，若布局改变)-重绘-合成</li><li>css 动画，过程:(回流，若布局改变)-重绘-合成</li></ol><p>所以不难看出，耗费性能最少并能并最流畅的动画是只出发合成。</p><p>为了仅发生 composite，我们做动画的 css property 必须满足以下三个条件：</p><ol><li>不影响文档流。</li><li>不依赖文档流。</li><li>不会造成重绘。</li></ol><p>满足以上以上条件的 css property 只有 transform 和 opacity。</p><p>这样的话，由于没有回流和重绘，只有合成，那么浏览器在动画执行之前就知道动画如何开始和结束。</p><p>并且有两个优势：</p><ol><li>动画将会非常流畅</li><li>动画不在绑定到 CPU，即使 js 执行大量的工作；动画依然流畅</li></ol><p>事实上影响动画流畅性的因素不止回流重绘，还有 cpu 内存。</p><p>css 动画有一个重要的特性，它是完全工作在 GPU 上。因为你声明了一个动画如何开始和如何结束，浏览器会在动画开始前准备好所有需要的指令；并把它们发送给 GPU。</p><p>而如果使用 js 动画，浏览器必须计算每一帧的状态；为了保证平滑的动画，我们必须在浏览器主线程计算新状态；把它们发送给 GPU 至少 60 次每秒。</p><p>除了计算和发送数据比 css 动画要慢，主线程的负载也会影响动画； 当主线程的计算任务过多时，会造成动画的延迟、卡顿。</p><p><strong>优化重绘重排技巧总结</strong>：</p><ol><li>减少浏览器的重排和重绘的发生。</li><li>不要使用 table 布局。</li><li>css 动画中尽量只使用 transform 和 opacity，这不会发生重排和重绘。</li><li>尽可能地只使用 css 做动画。</li><li>避免浏览器隐式合成(未深入,一般不用)。</li><li>改变复合层的尺寸(未深入,一般不用)。</li></ol><p><strong>名词解释：</strong></p><blockquote><p>FP：body 首个元素出现的时间</p><p>FCP：包含页面的基本框架，但是没有数据内容</p><p>FMP：包含页面所有的元素和数据</p><p>TII：</p></blockquote><h3 id="_1-2-csr-和-ssr"><a href="#_1-2-csr-和-ssr" aria-hidden="true" class="header-anchor">#</a> 1.2 CSR 和 SSR</h3><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">CSR</th><th style="text-align:center">SSR</th><th style="text-align:center">预渲染</th><th style="text-align:center">同构</th></tr></thead><tbody><tr><td style="text-align:center">优点</td><td style="text-align:center">1. 不依赖数据<br>2. FP 时间最快<br>客户端用户体验好</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">缺点</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table><h2 id="_2-服务器性能优化"><a href="#_2-服务器性能优化" aria-hidden="true" class="header-anchor">#</a> 2. 服务器性能优化</h2><p>jmeter</p></div><div class="content edit-link"><a href="https://github.com/Shiyanping/study-notes/edit/vuepress/docs/performance/performance.md" target="_blank" rel="noopener noreferrer">欢迎大家来补充</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/study-notes/qa/qa.html" class="prev">
          JavaScript &amp; QA 测试
        </a></span><span class="next"><a href="/study-notes/engineering/CI.html">
          持续集成
        </a> →
      </span></p></div></div></div></div>
    <script src="/study-notes/assets/js/22.ef8b4e2f.js" defer></script><script src="/study-notes/assets/js/app.403b6997.js" defer></script>
  </body>
</html>
