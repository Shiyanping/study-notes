(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{61:function(t,a,s){"use strict";s.r(a);var n=s(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"前端跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端跨域","aria-hidden":"true"}},[t._v("#")]),t._v(" 前端跨域")]),s("h2",{attrs:{id:"_1-导致跨域的原因："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-导致跨域的原因：","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 导致跨域的原因：")]),s("p",[t._v("同源策略：域名，协议，端口都相同。")]),s("h2",{attrs:{id:"_2-为什么要有同源策略："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-为什么要有同源策略：","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 为什么要有同源策略：")]),s("p",[t._v("浏览器不同的域名是不可以访问 Cookie 的，防止 Cookie 被盗用，防止隐私泄露。如果 Cookie 可以共享，那安全性就会很低。")]),s("h2",{attrs:{id:"_3-同源策略限制的范围"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-同源策略限制的范围","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 同源策略限制的范围")]),s("ol",[s("li",[t._v("Cookie，LocalStorage（超过 2.5M 会出现性能问题），IndexedDB 无法读取。")]),s("li",[t._v("DOM 无法获得")]),s("li",[t._v("Ajax 无法发送")])]),s("p",[s("strong",[t._v("Tips:")])]),s("blockquote",[s("ol",[s("li",[t._v("LocalStorage 大小 5M，但是使用 2.5M 以后会出现性能问题")]),s("li",[t._v("IndexedDB，web SQL：关系型数据库，有专门的 api 方法，大小 50M")])])]),s("h2",{attrs:{id:"_4-如何-cookie-共享"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-如何-cookie-共享","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. 如何 Cookie 共享")]),s("p",[t._v("使用 document.domain 设置同源策略。\n前端设置方法：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("www"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baidu"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com  a"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baidu"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'test=testCookie'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nbaike"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baidu"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com  b"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n")])]),s("p",[t._v("后端也可以设置，方法：")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Set-Cookie: key=value; domain=.example.com; path=/\n")])]),s("h2",{attrs:{id:"_5-解决跨域的方式："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-解决跨域的方式：","aria-hidden":"true"}},[t._v("#")]),t._v(" 5. 解决跨域的方式：")]),s("ul",[s("li",[t._v("jsonp")])]),s("p",[t._v("jsonp 只能发送 GET 请求，jsonp 原理：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("example")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("//  {code: 0}")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),s("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"http://www.baidu.com/test.php?callback=example"')]),s("span",{attrs:{class:"token operator"}},[t._v(">")]),s("span",{attrs:{class:"token operator"}},[t._v("<")]),s("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// 后端代码")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// if(callback) {")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("//   return callback( {code: 0} )")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("//   相当于 return example( {code: 0} )")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// } else {")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("//   {code: 0}")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),s("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),s("ul",[s("li",[t._v("CORS")])]),s("p",[t._v("跨域资源分享，允许任务类型的请求。")]),s("ul",[s("li",[t._v("Nginx 配置跨域")]),s("li",[t._v("img，iframe，script，link 标签没有被同源策略屏蔽")])]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 利用img标签可以跨域的方式，使用image标签测试用户网速")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" image "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Image")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" start "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("now")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 获取当前时间")]),t._v("\nimage"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'http://www.baidu.com/test.png'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 服务器上的一个图片地址，要知道具体多大")]),t._v("\nimage"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" end "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("now")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 获取加载完图片的时间")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" t "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" start "),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" end"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 获取时间差")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// kb/s")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" v "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'图片大小'")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" t"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("ul",[s("li",[t._v("postMessage（iframe，img）")]),s("li",[t._v("WebSocket")])])])}],!1,null,null,null);a.default=o.exports}}]);