(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{70:function(t,e,i){"use strict";i.r(e);var r=i(0),a=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("h1",{attrs:{id:"性能优化"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#性能优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 性能优化")]),i("h2",{attrs:{id:"_1-前端性能优化"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_1-前端性能优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 前端性能优化")]),i("h3",{attrs:{id:"_1-1-雅虎军规"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-雅虎军规","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.1 雅虎军规")]),i("ol",[i("li",[t._v("减少 HTTP 请求，合并 HTTP 请求")]),i("li",[t._v("减少 DNS 查找次数，可以使用 DNS 预解析")]),i("li",[t._v("减少不必要的跳转，减少 301，302 重定向")]),i("li",[t._v("做缓存，ETag，expiress，cache-control")]),i("li",[t._v("减少 DOM 元素，在用 JS 操作 dom 时，对需要重复使用 dom 进行变量缓存，防止多次获取 dom")]),i("li",[t._v("延迟加载，图片的懒加载")]),i("li",[t._v("预加载，在一个页面预先加载另外一个页面")]),i("li",[t._v("尽量不要使用 iframe")]),i("li",[t._v("静态资源一定要使用 CDN 进行内容分发")]),i("li",[t._v("不要将所有的资源都放到一个域名下，因为浏览器在解析同一个域名下的资源时会有限制，超过一定数量之后的资源需要等前面的资源加载完毕之后再加载，比如 Google 浏览器同时可以加载一个域名下的 6 个资源")]),i("li",[t._v("静态资源（JS，CSS，image）进行压缩合并，不要重复引用同一个资源，在下发静态资源时服务器要启用 gzip 压缩")]),i("li",[t._v("能使用 ssr 是最好的，服务器可以先使用模板对页面骨架首屏内容进行输出，后续加载的内容交给页面中的 JS 处理")]),i("li",[t._v("CSS 在顶部，JS 在底部，防止 CSS 在底部对页面造成重绘，防止 JS 在前面阻塞页面渲染")]),i("li",[t._v("减少 cookie 体积")]),i("li",[t._v("favicon.ico 在移动端可以做成不显示，PC 可以使用 base64")])]),i("h3",{attrs:{id:"_1-2-重绘重排"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-重绘重排","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.2 重绘重排")]),i("p",[t._v("什么情况下会造成重排：")]),i("ol",[i("li",[t._v("添加或者删除元素的时候")]),i("li",[t._v("元素的位置发生改变时")]),i("li",[t._v("页面初始化")]),i("li",[t._v("内容变化。在标准盒模型下添加 padding，border 就会造成重排，所以在书写样式的时候，很多会将盒模型设计成怪异盒模型（box-sizing: border-box）")]),i("li",[t._v("js 读取或者修改元素的 offset，width，height，scroll 时，因为在 js 中读取，会导致代码不知所措，不知道该不该继续优化页面，所以会导致重排。使用 requestAnimationFrame 可以进行优化，在下一帧进行操作。")])]),i("p",[t._v("GPU:用来加速处理计算请求，一般是涉及图形、视频的渲染。")]),i("p",[t._v("谷歌浏览器检测重绘工具：右上角...，moretool，rendering。")]),i("p",[i("strong",[t._v("浏览器渲染过程")]),t._v("：")]),i("p",[t._v("1.解析 html,xhtml,svg，形成 dom 树。")]),i("p",[t._v("2.解析 css，产生 css rule tree。")]),i("p",[t._v("3.解析 js，js 会通过 api 来操作 dom tree 和 css rule tree。")]),i("p",[t._v("4.构建 render tree(把 dom tree 和 css rule tree 合并)")]),i("p",[t._v("5.浏览器对元素进行定位和布局(reflow、layout、回流)")]),i("p",[t._v("6.浏览器绘制元素，即重绘或 repaint(样式，颜色，背景，大小及边框等)")]),i("p",[t._v("7.将各层发给 GPU，GPU 将各层合成，显示在屏幕上，即 composite。")]),i("p",[t._v("回流(布局变化引起回流)与重绘(只要元素样式变化就引起重绘)都耗费浏览器性能，尤其是回流。(回流一定引起重绘，重绘不一定回流)。")]),i("p",[t._v("优化:浏览器为了优化，浏览器会将 reflow 和 repaint 的操作积攒一批，然后做一次 reflow。但是有些时候，你的代码会强制浏览器做多次 reflow。比如用 js 多个样式多次改变，而不是多个样式改变放在一次操作里。")]),i("p",[i("strong",[t._v("下面是一些针对 reflow 和 repaint 的最佳实践：")])]),i("ol",[i("li",[t._v("不要一条一条地修改 dom 的样式，尽量使用 className 一次修改。")]),i("li",[t._v("将 dom 离线后修改")]),i("li",[t._v("使用 documentFragment 对象在内存里操作 dom。")]),i("li",[t._v("先把 dom 节点 display:none;（会触发一次 reflow）。然后做大量的修改后，再把它显示出来。")]),i("li",[t._v("clone 一个 dom 节点在内存里，修改之后；与在线的节点相替换。")]),i("li",[t._v("不要使用 table 布局，一个小改动会造成整个 table 的重新布局。")]),i("li",[t._v("transform 和 opacity 只会引起合成，不会引起布局和重绘。")])]),i("p",[i("strong",[t._v("composite-合成的工作方式:")])]),i("p",[t._v("每一次重绘后，浏览器都把重绘后的图像发给 GPU 去合成并显示。")]),i("p",[t._v("在动画中，浏览器每一帧都发给 GPU 去合成，因为回流和重绘发生在动画的每一帧。")]),i("ol",[i("li",[t._v("js 写的动画，过程:js 计算-(回流，若布局改变)-重绘-合成")]),i("li",[t._v("css 动画，过程:(回流，若布局改变)-重绘-合成")])]),i("p",[t._v("所以不难看出，耗费性能最少并能并最流畅的动画是只出发合成。")]),i("p",[t._v("为了仅发生 composite，我们做动画的 css property 必须满足以下三个条件：")]),i("ol",[i("li",[t._v("不影响文档流。")]),i("li",[t._v("不依赖文档流。")]),i("li",[t._v("不会造成重绘。")])]),i("p",[t._v("满足以上以上条件的 css property 只有 transform 和 opacity。")]),i("p",[t._v("这样的话，由于没有回流和重绘，只有合成，那么浏览器在动画执行之前就知道动画如何开始和结束。")]),i("p",[t._v("并且有两个优势：")]),i("ol",[i("li",[t._v("动画将会非常流畅")]),i("li",[t._v("动画不在绑定到 CPU，即使 js 执行大量的工作；动画依然流畅")])]),i("p",[t._v("事实上影响动画流畅性的因素不止回流重绘，还有 cpu 内存。")]),i("p",[t._v("css 动画有一个重要的特性，它是完全工作在 GPU 上。因为你声明了一个动画如何开始和如何结束，浏览器会在动画开始前准备好所有需要的指令；并把它们发送给 GPU。")]),i("p",[t._v("而如果使用 js 动画，浏览器必须计算每一帧的状态；为了保证平滑的动画，我们必须在浏览器主线程计算新状态；把它们发送给 GPU 至少 60 次每秒。")]),i("p",[t._v("除了计算和发送数据比 css 动画要慢，主线程的负载也会影响动画； 当主线程的计算任务过多时，会造成动画的延迟、卡顿。")]),i("p",[i("strong",[t._v("优化重绘重排技巧总结")]),t._v("：")]),i("ol",[i("li",[t._v("减少浏览器的重排和重绘的发生。")]),i("li",[t._v("不要使用 table 布局。")]),i("li",[t._v("css 动画中尽量只使用 transform 和 opacity，这不会发生重排和重绘。")]),i("li",[t._v("尽可能地只使用 css 做动画。")]),i("li",[t._v("避免浏览器隐式合成(未深入,一般不用)。")]),i("li",[t._v("改变复合层的尺寸(未深入,一般不用)。")])]),i("p",[i("strong",[t._v("名词解释：")])]),i("blockquote",[i("p",[t._v("FP：body 首个元素出现的时间")]),i("p",[t._v("FCP：包含页面的基本框架，但是没有数据内容")]),i("p",[t._v("FMP：包含页面所有的元素和数据")]),i("p",[t._v("TII：")])]),i("h3",{attrs:{id:"_1-2-csr-和-ssr"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-csr-和-ssr","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.2 CSR 和 SSR")]),i("table",[i("thead",[i("tr",[i("th",{staticStyle:{"text-align":"center"}}),i("th",{staticStyle:{"text-align":"center"}},[t._v("CSR")]),i("th",{staticStyle:{"text-align":"center"}},[t._v("SSR")]),i("th",{staticStyle:{"text-align":"center"}},[t._v("预渲染")]),i("th",{staticStyle:{"text-align":"center"}},[t._v("同构")])])]),i("tbody",[i("tr",[i("td",{staticStyle:{"text-align":"center"}},[t._v("优点")]),i("td",{staticStyle:{"text-align":"center"}},[t._v("1. 不依赖数据"),i("br"),t._v("2. FP 时间最快"),i("br"),t._v("客户端用户体验好")]),i("td",{staticStyle:{"text-align":"center"}}),i("td",{staticStyle:{"text-align":"center"}}),i("td",{staticStyle:{"text-align":"center"}})]),i("tr",[i("td",{staticStyle:{"text-align":"center"}},[t._v("缺点")]),i("td",{staticStyle:{"text-align":"center"}}),i("td",{staticStyle:{"text-align":"center"}}),i("td",{staticStyle:{"text-align":"center"}}),i("td",{staticStyle:{"text-align":"center"}})])])]),i("h2",{attrs:{id:"_2-服务器性能优化"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务器性能优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 服务器性能优化")]),i("p",[t._v("jmeter")])])}],!1,null,null,null);e.default=a.exports}}]);